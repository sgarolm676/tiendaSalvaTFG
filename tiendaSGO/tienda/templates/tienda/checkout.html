{% extends 'base.html' %}
{% load i18n %}

{% block content %}
	<div class="card text-black mx-auto mt-5" style="width: 500px;">
        <div class="card-body text-center">
            <h2 class="h1 card-title">{% translate "Comprando" %} {{ producto.name }}</h2>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li><b>{% translate "Marca" %}: </b>{{ producto.marca }}</li>
                    <li><b>{% translate "Modelo" %}: </b>{{ producto.modelo }}</li>
                    <li><b>{% translate "Unidades" %}: </b>{{ producto.unidades }}</li>
                    <li><b>{% translate "Precio por unidad" %}: </b>{{ producto.precio }}€</li>
                </ul>
                <form class="form-login mt-5" method="post" action="">
                    {% csrf_token %}
                    {% for f in form %}
                        <div class="mb-3"><label>{{ f.label }}</label>{{ f }}</div>
                        {{ f.errors }}
                    {% endfor %}
                    <button type="submit" class="btn btn-success mt-3">{% translate "Comprar" %}</button>
                </form>
                <form method="POST" class="form-login mt-1" action={% url "carrito" pk=producto.pk %}>
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn btn-info">{% translate "Añadir al carrito" %}</button>
                </form>
            </div>
        </div>
    </div>
    <h2 class="mt-3">Valoraciones
        {% if can_add_rate %}
        <form method="GET" class="d-inline" action={% url "add_valoracion" pk=producto.pk %}>
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <button type="submit" class="btn btn-sm btn-success">{% translate "Añadir" %}</button>
        </form>
        {% endif %}
    </h2>
    <table class="table table-striped table-dark text-center">
        <tr>
            <th>{% translate "Cliente" %}</th>
            <th>{% translate "Comentario" %}</th>
            <th>{% translate "Valoración" %}</th>
            <th></th>
            <th></th>
        </tr>
        {% for v in valoraciones %}
        <tr>
            <td>{{v.cliente}}</th>
            <td>{{v.comentario}}</th>
            <td>{{v.rate}}/5</th>
            <td>
                {% if v.cliente.user == user or perms.tienda.change_valoracion %}
                <form method="GET" class="d-inline" action="{% url "update_valoracion" pk=v.pk %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn btn-sm btn-info">{% translate "Editar" %}</button>
                </form>
                {% endif %}
            </td>
            <td>
                {% if v.cliente.user == user or perms.tienda.change_valoracion %}
                <form method="GET" class="d-inline" action="{% url "delete_valoracion" pk=v.pk %}">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn btn-sm btn-danger">{% translate "Borrar" %}</button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        
    </table>

{% endblock %}
